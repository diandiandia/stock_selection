2025-08-25 13:44:07 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 13:44:07 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 13:44:07 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 13:44:07 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:01:42 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:01:42 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:01:42 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:01:42 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:01:44 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:01:44 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:01:44 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:01:44 - __main__ - ERROR - 系统执行失败: __init__() got an unexpected keyword argument 'vif_threshold'
Traceback (most recent call last):
  File "d:\Projects\stock_selection\main.py", line 54, in main
    preprocessor = DataPreprocessor(
TypeError: __init__() got an unexpected keyword argument 'vif_threshold'
2025-08-25 14:04:14 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:04:14 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:04:14 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:04:14 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:04:17 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:04:17 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:04:17 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:04:17 - __main__ - ERROR - 系统执行失败: name 'feature_scaler_type' is not defined
Traceback (most recent call last):
  File "d:\Projects\stock_selection\main.py", line 54, in main
    preprocessor = DataPreprocessor(
  File "d:\Projects\stock_selection\src\data_preprocessing\data_preprocessor.py", line 64, in __init__
    ) if feature_scaler_type == 'standard' else MinMaxScaler()
NameError: name 'feature_scaler_type' is not defined
2025-08-25 14:05:31 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:05:31 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:05:31 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:05:31 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:05:33 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:05:34 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:05:34 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:05:34 - __main__ - ERROR - 系统执行失败: name 'target_scaler_type' is not defined
Traceback (most recent call last):
  File "d:\Projects\stock_selection\main.py", line 54, in main
    preprocessor = DataPreprocessor(
  File "d:\Projects\stock_selection\src\data_preprocessing\data_preprocessor.py", line 69, in __init__
    ) if target_scaler_type == 'standard' else MinMaxScaler()
NameError: name 'target_scaler_type' is not defined
2025-08-25 14:07:23 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:07:23 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:07:23 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:07:23 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:07:25 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:07:26 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:07:26 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:07:26 - __main__ - ERROR - 系统执行失败: 'vol'
Traceback (most recent call last):
  File "D:\Projects\stock_selection\.venv\lib\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'vol'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\Projects\stock_selection\main.py", line 67, in main
    quality_report = preprocessor.check_data_quality(df)
  File "d:\Projects\stock_selection\src\data_preprocessing\data_preprocessor.py", line 464, in check_data_quality
    'volume_anomalies': len(df[df['vol'] <= 0]),
  File "D:\Projects\stock_selection\.venv\lib\site-packages\pandas\core\frame.py", line 4107, in __getitem__
    indexer = self.columns.get_loc(key)
  File "D:\Projects\stock_selection\.venv\lib\site-packages\pandas\core\indexes\base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'vol'
2025-08-25 14:08:53 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:08:53 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:08:53 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:08:53 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:08:55 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:08:55 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:08:55 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:08:55 - src.data_preprocessing.data_preprocessor - INFO - DataFrame columns: ['trade_date', 'ts_code', 'open', 'close', 'high', 'low', 'volume', 'amount', 'amplitude', 'change', 'change_amount', 'turnover']
2025-08-25 14:10:55 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:10:55 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:10:55 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:10:55 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:10:57 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:10:57 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:10:57 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:10:57 - src.data_preprocessing.data_preprocessor - INFO - DataFrame columns: ['trade_date', 'ts_code', 'open', 'close', 'high', 'low', 'volume', 'amount', 'amplitude', 'change', 'change_amount', 'turnover']
2025-08-25 14:10:58 - __main__ - INFO - 数据质量报告:
缺失值统计: {'trade_date': 0, 'ts_code': 0, 'open': 0, 'close': 0, 'high': 0, 'low': 0, 'volume': 0, 'amount': 0, 'amplitude': 0, 'change': 0, 'change_amount': 796, 'turnover': 0}
重复记录数: 0
股票覆盖数: 800
交易日期范围: ('20220104', '20250819')
价格异常数: 0
成交量异常数: 0
2025-08-25 14:10:58 - __main__ - INFO - ====== 开始计算技术指标 ======
2025-08-25 14:11:14 - __main__ - INFO - 技术指标计算完成，无NaN值
2025-08-25 14:11:14 - __main__ - INFO - ====== 初始化LSTM+LightGBM模型 ======
2025-08-25 14:11:14 - __main__ - INFO - ====== 数据预处理和SHAP特征选择 ======
2025-08-25 14:11:14 - src.data_preprocessing.data_preprocessor - INFO - 开始数据预处理和拟合...
2025-08-25 14:11:14 - src.data_preprocessing.data_preprocessor - INFO - 输入数据形状: (691696, 33)
2025-08-25 14:11:14 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成...
2025-08-25 14:11:14 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成，股票数量: 800
2025-08-25 14:11:14 - src.data_preprocessing.data_preprocessor - INFO - 创建技术信号...
2025-08-25 14:11:14 - src.data_preprocessing.data_preprocessor - INFO - 技术信号创建完成，新增特征数量: 1
2025-08-25 14:11:14 - src.data_preprocessing.data_preprocessor - INFO - 开始创建目标变量，预测周期: 5
2025-08-25 14:11:14 - src.data_preprocessing.data_preprocessor - INFO - 目标变量创建完成，有效样本数: 691691, 均值: 0.0136, 标准差: 1.0706
2025-08-25 14:11:14 - src.data_preprocessing.data_preprocessor - INFO - 开始特征选择...
2025-08-25 14:11:14 - src.data_preprocessing.data_preprocessor - INFO - 原始特征数量: 31
2025-08-25 14:11:14 - src.data_preprocessing.data_preprocessor - INFO - 缺失值过滤后特征数量: 31
2025-08-25 14:11:14 - src.data_preprocessing.data_preprocessor - INFO - 开始多重共线性检测，输入特征数量: 31, VIF阈值: 5.0
2025-08-25 14:11:15 - src.data_preprocessing.data_preprocessor - INFO - 预过滤高相关特征: 70 个 (相关系数>0.8)
2025-08-25 14:12:07 - src.data_preprocessing.data_preprocessor - INFO - 多重共线性检测完成: 最终选择 6 个特征
2025-08-25 14:12:07 - src.data_preprocessing.data_preprocessor - INFO - 选择的特征: ['change', 'turnover', 'CCI', 'OBV', 'CMF', 'CDL_DOJI']
2025-08-25 14:12:07 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据...
2025-08-25 14:12:07 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据，特征数量: 6
2025-08-25 14:12:07 - src.data_preprocessing.data_preprocessor - INFO - Processing stocks: 
2025-08-25 14:12:12 - src.data_preprocessing.data_preprocessor - INFO - 序列诊断: 总股票 800, 跳过数据不足 1, 跳过NaN序列 0, 有效序列 671641
2025-08-25 14:12:12 - src.data_preprocessing.data_preprocessor - INFO - 生成序列完成: 671641个样本，维度: (671641, 20, 6)
2025-08-25 14:12:12 - src.data_preprocessing.data_preprocessor - INFO - 计算特征异常值边界...
2025-08-25 14:12:12 - __main__ - ERROR - 系统执行失败: 'DataPreprocessor' object has no attribute 'imputation_strategy'
Traceback (most recent call last):
  File "d:\Projects\stock_selection\main.py", line 100, in main
    X_sequence_scaled, y_scaled, stock_codes, dates = preprocessor.fit(
  File "d:\Projects\stock_selection\src\data_preprocessing\data_preprocessor.py", line 252, in fit
    if self.imputation_strategy == 'hybrid':
AttributeError: 'DataPreprocessor' object has no attribute 'imputation_strategy'
2025-08-25 14:14:42 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:14:42 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:14:42 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:14:42 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:14:44 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:14:44 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:14:44 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:14:44 - src.data_preprocessing.data_preprocessor - INFO - DataFrame columns: ['trade_date', 'ts_code', 'open', 'close', 'high', 'low', 'volume', 'amount', 'amplitude', 'change', 'change_amount', 'turnover']
2025-08-25 14:14:45 - __main__ - INFO - 数据质量报告:
缺失值统计: {'trade_date': 0, 'ts_code': 0, 'open': 0, 'close': 0, 'high': 0, 'low': 0, 'volume': 0, 'amount': 0, 'amplitude': 0, 'change': 0, 'change_amount': 796, 'turnover': 0}
重复记录数: 0
股票覆盖数: 800
交易日期范围: ('20220104', '20250819')
价格异常数: 0
成交量异常数: 0
2025-08-25 14:14:45 - __main__ - INFO - ====== 开始计算技术指标 ======
2025-08-25 14:15:01 - __main__ - INFO - 技术指标计算完成，无NaN值
2025-08-25 14:15:01 - __main__ - INFO - ====== 初始化LSTM+LightGBM模型 ======
2025-08-25 14:15:01 - __main__ - INFO - ====== 数据预处理和SHAP特征选择 ======
2025-08-25 14:15:01 - src.data_preprocessing.data_preprocessor - INFO - 开始数据预处理和拟合...
2025-08-25 14:15:01 - src.data_preprocessing.data_preprocessor - INFO - 输入数据形状: (691696, 33)
2025-08-25 14:15:01 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成...
2025-08-25 14:15:01 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成，股票数量: 800
2025-08-25 14:15:01 - src.data_preprocessing.data_preprocessor - INFO - 创建技术信号...
2025-08-25 14:15:01 - src.data_preprocessing.data_preprocessor - INFO - 技术信号创建完成，新增特征数量: 1
2025-08-25 14:15:01 - src.data_preprocessing.data_preprocessor - INFO - 开始创建目标变量，预测周期: 5
2025-08-25 14:15:02 - src.data_preprocessing.data_preprocessor - INFO - 目标变量创建完成，有效样本数: 691691, 均值: 0.0136, 标准差: 1.0706
2025-08-25 14:15:02 - src.data_preprocessing.data_preprocessor - INFO - 开始特征选择...
2025-08-25 14:15:02 - src.data_preprocessing.data_preprocessor - INFO - 原始特征数量: 31
2025-08-25 14:15:02 - src.data_preprocessing.data_preprocessor - INFO - 缺失值过滤后特征数量: 31
2025-08-25 14:15:02 - src.data_preprocessing.data_preprocessor - INFO - 开始多重共线性检测，输入特征数量: 31, VIF阈值: 5.0
2025-08-25 14:15:03 - src.data_preprocessing.data_preprocessor - INFO - 预过滤高相关特征: 70 个 (相关系数>0.8)
2025-08-25 14:15:57 - src.data_preprocessing.data_preprocessor - INFO - 多重共线性检测完成: 最终选择 6 个特征
2025-08-25 14:15:57 - src.data_preprocessing.data_preprocessor - INFO - 选择的特征: ['change', 'turnover', 'CCI', 'OBV', 'CMF', 'CDL_DOJI']
2025-08-25 14:15:57 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据...
2025-08-25 14:15:57 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据，特征数量: 6
2025-08-25 14:15:57 - src.data_preprocessing.data_preprocessor - INFO - Processing stocks: 
2025-08-25 14:16:03 - src.data_preprocessing.data_preprocessor - INFO - 序列诊断: 总股票 800, 跳过数据不足 1, 跳过NaN序列 0, 有效序列 671641
2025-08-25 14:16:03 - src.data_preprocessing.data_preprocessor - INFO - 生成序列完成: 671641个样本，维度: (671641, 20, 6)
2025-08-25 14:16:03 - src.data_preprocessing.data_preprocessor - INFO - 计算特征异常值边界...
2025-08-25 14:16:03 - __main__ - ERROR - 系统执行失败: 'DataPreprocessor' object has no attribute 'outlier_detection'
Traceback (most recent call last):
  File "d:\Projects\stock_selection\main.py", line 101, in main
    X_sequence_scaled, y_scaled, stock_codes, dates = preprocessor.fit(
  File "d:\Projects\stock_selection\src\data_preprocessing\data_preprocessor.py", line 264, in fit
    if self.outlier_detection == 'zscore':
AttributeError: 'DataPreprocessor' object has no attribute 'outlier_detection'
2025-08-25 14:19:27 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:19:27 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:19:27 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:19:27 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:19:29 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:19:29 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:19:29 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:19:29 - src.data_preprocessing.data_preprocessor - INFO - DataFrame columns: ['trade_date', 'ts_code', 'open', 'close', 'high', 'low', 'volume', 'amount', 'amplitude', 'change', 'change_amount', 'turnover']
2025-08-25 14:19:29 - __main__ - INFO - 数据质量报告:
缺失值统计: {'trade_date': 0, 'ts_code': 0, 'open': 0, 'close': 0, 'high': 0, 'low': 0, 'volume': 0, 'amount': 0, 'amplitude': 0, 'change': 0, 'change_amount': 796, 'turnover': 0}
重复记录数: 0
股票覆盖数: 800
交易日期范围: ('20220104', '20250819')
价格异常数: 0
成交量异常数: 0
2025-08-25 14:19:29 - __main__ - INFO - ====== 开始计算技术指标 ======
2025-08-25 14:19:46 - __main__ - INFO - 技术指标计算完成，无NaN值
2025-08-25 14:19:46 - __main__ - INFO - ====== 初始化LSTM+LightGBM模型 ======
2025-08-25 14:19:46 - __main__ - INFO - ====== 数据预处理和SHAP特征选择 ======
2025-08-25 14:19:46 - src.data_preprocessing.data_preprocessor - INFO - 开始数据预处理和拟合...
2025-08-25 14:19:46 - src.data_preprocessing.data_preprocessor - INFO - 输入数据形状: (691696, 33)
2025-08-25 14:19:46 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成...
2025-08-25 14:19:46 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成，股票数量: 800
2025-08-25 14:19:46 - src.data_preprocessing.data_preprocessor - INFO - 创建技术信号...
2025-08-25 14:19:46 - src.data_preprocessing.data_preprocessor - INFO - 技术信号创建完成，新增特征数量: 1
2025-08-25 14:19:46 - src.data_preprocessing.data_preprocessor - INFO - 开始创建目标变量，预测周期: 5
2025-08-25 14:19:46 - src.data_preprocessing.data_preprocessor - INFO - 目标变量创建完成，有效样本数: 691691, 均值: 0.0136, 标准差: 1.0706
2025-08-25 14:19:46 - src.data_preprocessing.data_preprocessor - INFO - 开始特征选择...
2025-08-25 14:19:46 - src.data_preprocessing.data_preprocessor - INFO - 原始特征数量: 31
2025-08-25 14:19:47 - src.data_preprocessing.data_preprocessor - INFO - 缺失值过滤后特征数量: 31
2025-08-25 14:19:47 - src.data_preprocessing.data_preprocessor - INFO - 开始多重共线性检测，输入特征数量: 31, VIF阈值: 5.0
2025-08-25 14:19:48 - src.data_preprocessing.data_preprocessor - INFO - 预过滤高相关特征: 70 个 (相关系数>0.8)
2025-08-25 14:20:43 - src.data_preprocessing.data_preprocessor - INFO - 多重共线性检测完成: 最终选择 6 个特征
2025-08-25 14:20:43 - src.data_preprocessing.data_preprocessor - INFO - 选择的特征: ['change', 'turnover', 'CCI', 'OBV', 'CMF', 'CDL_DOJI']
2025-08-25 14:20:43 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据...
2025-08-25 14:20:43 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据，特征数量: 6
2025-08-25 14:20:43 - src.data_preprocessing.data_preprocessor - INFO - Processing stocks: 
2025-08-25 14:20:48 - src.data_preprocessing.data_preprocessor - INFO - 序列诊断: 总股票 800, 跳过数据不足 1, 跳过NaN序列 0, 有效序列 671641
2025-08-25 14:20:48 - src.data_preprocessing.data_preprocessor - INFO - 生成序列完成: 671641个样本，维度: (671641, 20, 6)
2025-08-25 14:20:48 - src.data_preprocessing.data_preprocessor - INFO - 计算特征异常值边界...
2025-08-25 14:20:48 - src.data_preprocessing.data_preprocessor - INFO - 特征异常值边界计算完成: 6 个特征
2025-08-25 14:20:48 - src.data_preprocessing.data_preprocessor - INFO - 开始清洗数据...
2025-08-25 14:20:49 - src.data_preprocessing.data_preprocessor - INFO - 特征 change: 裁剪范围 [0.01, 0.01]
2025-08-25 14:20:50 - src.data_preprocessing.data_preprocessor - INFO - 特征 turnover: 裁剪范围 [0.01, 0.01]
2025-08-25 14:20:50 - src.data_preprocessing.data_preprocessor - INFO - 特征 CCI: 裁剪范围 [0.01, 0.01]
2025-08-25 14:20:51 - src.data_preprocessing.data_preprocessor - INFO - 特征 OBV: 裁剪范围 [0.01, 0.01]
2025-08-25 14:20:52 - src.data_preprocessing.data_preprocessor - INFO - 特征 CMF: 裁剪范围 [0.01, 0.01]
2025-08-25 14:20:52 - src.data_preprocessing.data_preprocessor - INFO - 特征 CDL_DOJI: 裁剪范围 [0.01, 0.01]
2025-08-25 14:20:52 - src.data_preprocessing.data_preprocessor - INFO - 数据清洗完成
2025-08-25 14:20:52 - src.data_preprocessing.data_preprocessor - INFO - 处理目标变量...
2025-08-25 14:20:52 - src.data_preprocessing.data_preprocessor - INFO - 目标变量无需填充，均值: 0.0143
2025-08-25 14:20:52 - src.data_preprocessing.data_preprocessor - INFO - 计算目标变量异常值阈值...
2025-08-25 14:20:52 - src.data_preprocessing.data_preprocessor - INFO - 目标变量异常值范围: [-5.4179, 5.4465]
2025-08-25 14:20:52 - src.data_preprocessing.data_preprocessor - INFO - 目标变量异常值处理: 裁剪 5% 上下限
2025-08-25 14:20:52 - src.data_preprocessing.data_preprocessor - INFO - 拟合特征缩放器...
2025-08-25 14:20:54 - src.data_preprocessing.data_preprocessor - INFO - 拟合目标变量缩放器...
2025-08-25 14:20:54 - src.data_preprocessing.data_preprocessor - INFO - 执行特征重要性评估...
2025-08-25 14:20:55 - src.data_preprocessing.data_preprocessor - INFO - 特征重要性评估样本大小: 4848
2025-08-25 14:20:55 - __main__ - ERROR - 系统执行失败: 'NoneType' object has no attribute 'fit'
Traceback (most recent call last):
  File "d:\Projects\stock_selection\main.py", line 102, in main
    X_sequence_scaled, y_scaled, stock_codes, dates = preprocessor.fit(
  File "d:\Projects\stock_selection\src\data_preprocessing\data_preprocessor.py", line 368, in fit
    model.fit(X_sequence=X_subset_scaled,
  File "d:\Projects\stock_selection\src\model\lstm_lgbm_predictor.py", line 147, in fit
    lstm_history = self.lstm_model.fit(
AttributeError: 'NoneType' object has no attribute 'fit'
2025-08-25 14:24:23 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:24:23 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:24:23 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:24:23 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:24:25 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:24:25 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:24:25 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:24:25 - src.data_preprocessing.data_preprocessor - INFO - DataFrame columns: ['trade_date', 'ts_code', 'open', 'close', 'high', 'low', 'volume', 'amount', 'amplitude', 'change', 'change_amount', 'turnover']
2025-08-25 14:24:26 - __main__ - INFO - 数据质量报告:
缺失值统计: {'trade_date': 0, 'ts_code': 0, 'open': 0, 'close': 0, 'high': 0, 'low': 0, 'volume': 0, 'amount': 0, 'amplitude': 0, 'change': 0, 'change_amount': 796, 'turnover': 0}
重复记录数: 0
股票覆盖数: 800
交易日期范围: ('20220104', '20250819')
价格异常数: 0
成交量异常数: 0
2025-08-25 14:24:26 - __main__ - INFO - ====== 开始计算技术指标 ======
2025-08-25 14:24:41 - __main__ - INFO - 技术指标计算完成，无NaN值
2025-08-25 14:24:42 - __main__ - INFO - ====== 初始化LSTM+LightGBM模型 ======
2025-08-25 14:24:42 - __main__ - INFO - 模型初始化成功
2025-08-25 14:24:42 - __main__ - INFO - ====== 数据预处理和SHAP特征选择 ======
2025-08-25 14:24:42 - src.data_preprocessing.data_preprocessor - INFO - 开始数据预处理和拟合...
2025-08-25 14:24:42 - src.data_preprocessing.data_preprocessor - INFO - 输入数据形状: (691696, 33)
2025-08-25 14:24:42 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成...
2025-08-25 14:24:42 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成，股票数量: 800
2025-08-25 14:24:42 - src.data_preprocessing.data_preprocessor - INFO - 创建技术信号...
2025-08-25 14:24:42 - src.data_preprocessing.data_preprocessor - INFO - 技术信号创建完成，新增特征数量: 1
2025-08-25 14:24:42 - src.data_preprocessing.data_preprocessor - INFO - 开始创建目标变量，预测周期: 5
2025-08-25 14:24:42 - src.data_preprocessing.data_preprocessor - INFO - 目标变量创建完成，有效样本数: 691691, 均值: 0.0136, 标准差: 1.0706
2025-08-25 14:24:42 - src.data_preprocessing.data_preprocessor - INFO - 开始特征选择...
2025-08-25 14:24:42 - src.data_preprocessing.data_preprocessor - INFO - 原始特征数量: 31
2025-08-25 14:24:42 - src.data_preprocessing.data_preprocessor - INFO - 缺失值过滤后特征数量: 31
2025-08-25 14:24:42 - src.data_preprocessing.data_preprocessor - INFO - 开始多重共线性检测，输入特征数量: 31, VIF阈值: 5.0
2025-08-25 14:24:43 - src.data_preprocessing.data_preprocessor - INFO - 预过滤高相关特征: 70 个 (相关系数>0.8)
2025-08-25 14:25:39 - src.data_preprocessing.data_preprocessor - INFO - 多重共线性检测完成: 最终选择 6 个特征
2025-08-25 14:25:39 - src.data_preprocessing.data_preprocessor - INFO - 选择的特征: ['change', 'turnover', 'CCI', 'OBV', 'CMF', 'CDL_DOJI']
2025-08-25 14:25:39 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据...
2025-08-25 14:25:39 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据，特征数量: 6
2025-08-25 14:25:39 - src.data_preprocessing.data_preprocessor - INFO - Processing stocks: 
2025-08-25 14:25:43 - src.data_preprocessing.data_preprocessor - INFO - 序列诊断: 总股票 800, 跳过数据不足 1, 跳过NaN序列 0, 有效序列 671641
2025-08-25 14:25:43 - src.data_preprocessing.data_preprocessor - INFO - 生成序列完成: 671641个样本，维度: (671641, 20, 6)
2025-08-25 14:25:43 - src.data_preprocessing.data_preprocessor - INFO - 计算特征异常值边界...
2025-08-25 14:25:43 - src.data_preprocessing.data_preprocessor - INFO - 特征异常值边界计算完成: 6 个特征
2025-08-25 14:25:43 - src.data_preprocessing.data_preprocessor - INFO - 开始清洗数据...
2025-08-25 14:25:44 - src.data_preprocessing.data_preprocessor - INFO - 特征 change: 裁剪范围 [0.01, 0.01]
2025-08-25 14:25:45 - src.data_preprocessing.data_preprocessor - INFO - 特征 turnover: 裁剪范围 [0.01, 0.01]
2025-08-25 14:25:45 - src.data_preprocessing.data_preprocessor - INFO - 特征 CCI: 裁剪范围 [0.01, 0.01]
2025-08-25 14:25:46 - src.data_preprocessing.data_preprocessor - INFO - 特征 OBV: 裁剪范围 [0.01, 0.01]
2025-08-25 14:25:47 - src.data_preprocessing.data_preprocessor - INFO - 特征 CMF: 裁剪范围 [0.01, 0.01]
2025-08-25 14:25:47 - src.data_preprocessing.data_preprocessor - INFO - 特征 CDL_DOJI: 裁剪范围 [0.01, 0.01]
2025-08-25 14:25:47 - src.data_preprocessing.data_preprocessor - INFO - 数据清洗完成
2025-08-25 14:25:47 - src.data_preprocessing.data_preprocessor - INFO - 处理目标变量...
2025-08-25 14:25:47 - src.data_preprocessing.data_preprocessor - INFO - 目标变量无需填充，均值: 0.0143
2025-08-25 14:25:47 - src.data_preprocessing.data_preprocessor - INFO - 计算目标变量异常值阈值...
2025-08-25 14:25:47 - src.data_preprocessing.data_preprocessor - INFO - 目标变量异常值范围: [-5.4179, 5.4465]
2025-08-25 14:25:47 - src.data_preprocessing.data_preprocessor - INFO - 目标变量异常值处理: 裁剪 5% 上下限
2025-08-25 14:25:47 - src.data_preprocessing.data_preprocessor - INFO - 拟合特征缩放器...
2025-08-25 14:25:49 - src.data_preprocessing.data_preprocessor - INFO - 拟合目标变量缩放器...
2025-08-25 14:25:49 - src.data_preprocessing.data_preprocessor - INFO - 执行特征重要性评估...
2025-08-25 14:25:50 - src.data_preprocessing.data_preprocessor - INFO - 特征重要性评估样本大小: 5172
2025-08-25 14:25:50 - __main__ - ERROR - 系统执行失败: 'LSTMLGBMPredictor' object has no attribute '_initialize_models'
Traceback (most recent call last):
  File "d:\Projects\stock_selection\main.py", line 107, in main
    X_sequence_scaled, y_scaled, stock_codes, dates = preprocessor.fit(
  File "d:\Projects\stock_selection\src\data_preprocessing\data_preprocessor.py", line 368, in fit
    model.fit(X_sequence=X_subset_scaled,
  File "d:\Projects\stock_selection\src\model\lstm_lgbm_predictor.py", line 142, in fit
    self._initialize_models()
AttributeError: 'LSTMLGBMPredictor' object has no attribute '_initialize_models'
2025-08-25 14:29:22 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:29:22 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:29:22 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:29:22 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:29:24 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:29:24 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:29:24 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:29:24 - src.data_preprocessing.data_preprocessor - INFO - DataFrame columns: ['trade_date', 'ts_code', 'open', 'close', 'high', 'low', 'volume', 'amount', 'amplitude', 'change', 'change_amount', 'turnover']
2025-08-25 14:29:25 - __main__ - INFO - 数据质量报告:
缺失值统计: {'trade_date': 0, 'ts_code': 0, 'open': 0, 'close': 0, 'high': 0, 'low': 0, 'volume': 0, 'amount': 0, 'amplitude': 0, 'change': 0, 'change_amount': 796, 'turnover': 0}
重复记录数: 0
股票覆盖数: 800
交易日期范围: ('20220104', '20250819')
价格异常数: 0
成交量异常数: 0
2025-08-25 14:29:25 - __main__ - INFO - ====== 开始计算技术指标 ======
2025-08-25 14:29:42 - __main__ - INFO - 技术指标计算完成，无NaN值
2025-08-25 14:29:42 - __main__ - INFO - ====== 初始化LSTM+LightGBM模型 ======
2025-08-25 14:29:42 - __main__ - INFO - 模型初始化成功
2025-08-25 14:29:42 - __main__ - INFO - ====== 数据预处理和SHAP特征选择 ======
2025-08-25 14:29:42 - src.data_preprocessing.data_preprocessor - INFO - 开始数据预处理和拟合...
2025-08-25 14:29:42 - src.data_preprocessing.data_preprocessor - INFO - 输入数据形状: (691696, 33)
2025-08-25 14:29:42 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成...
2025-08-25 14:29:42 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成，股票数量: 800
2025-08-25 14:29:42 - src.data_preprocessing.data_preprocessor - INFO - 创建技术信号...
2025-08-25 14:29:42 - src.data_preprocessing.data_preprocessor - INFO - 技术信号创建完成，新增特征数量: 1
2025-08-25 14:29:42 - src.data_preprocessing.data_preprocessor - INFO - 开始创建目标变量，预测周期: 5
2025-08-25 14:29:42 - src.data_preprocessing.data_preprocessor - INFO - 目标变量创建完成，有效样本数: 691691, 均值: 0.0136, 标准差: 1.0706
2025-08-25 14:29:42 - src.data_preprocessing.data_preprocessor - INFO - 开始特征选择...
2025-08-25 14:29:42 - src.data_preprocessing.data_preprocessor - INFO - 原始特征数量: 31
2025-08-25 14:29:42 - src.data_preprocessing.data_preprocessor - INFO - 缺失值过滤后特征数量: 31
2025-08-25 14:29:42 - src.data_preprocessing.data_preprocessor - INFO - 开始多重共线性检测，输入特征数量: 31, VIF阈值: 5.0
2025-08-25 14:29:44 - src.data_preprocessing.data_preprocessor - INFO - 预过滤高相关特征: 70 个 (相关系数>0.8)
2025-08-25 14:30:47 - src.data_preprocessing.data_preprocessor - INFO - 多重共线性检测完成: 最终选择 6 个特征
2025-08-25 14:30:47 - src.data_preprocessing.data_preprocessor - INFO - 选择的特征: ['change', 'turnover', 'CCI', 'OBV', 'CMF', 'CDL_DOJI']
2025-08-25 14:30:47 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据...
2025-08-25 14:30:47 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据，特征数量: 6
2025-08-25 14:30:47 - src.data_preprocessing.data_preprocessor - INFO - Processing stocks: 
2025-08-25 14:30:52 - src.data_preprocessing.data_preprocessor - INFO - 序列诊断: 总股票 800, 跳过数据不足 1, 跳过NaN序列 0, 有效序列 671641
2025-08-25 14:30:52 - src.data_preprocessing.data_preprocessor - INFO - 生成序列完成: 671641个样本，维度: (671641, 20, 6)
2025-08-25 14:30:52 - src.data_preprocessing.data_preprocessor - INFO - 计算特征异常值边界...
2025-08-25 14:30:52 - src.data_preprocessing.data_preprocessor - INFO - 特征异常值边界计算完成: 6 个特征
2025-08-25 14:30:52 - src.data_preprocessing.data_preprocessor - INFO - 开始清洗数据...
2025-08-25 14:30:53 - src.data_preprocessing.data_preprocessor - INFO - 特征 change: 裁剪范围 [0.01, 0.01]
2025-08-25 14:30:54 - src.data_preprocessing.data_preprocessor - INFO - 特征 turnover: 裁剪范围 [0.01, 0.01]
2025-08-25 14:30:54 - src.data_preprocessing.data_preprocessor - INFO - 特征 CCI: 裁剪范围 [0.01, 0.01]
2025-08-25 14:30:55 - src.data_preprocessing.data_preprocessor - INFO - 特征 OBV: 裁剪范围 [0.01, 0.01]
2025-08-25 14:30:56 - src.data_preprocessing.data_preprocessor - INFO - 特征 CMF: 裁剪范围 [0.01, 0.01]
2025-08-25 14:30:56 - src.data_preprocessing.data_preprocessor - INFO - 特征 CDL_DOJI: 裁剪范围 [0.01, 0.01]
2025-08-25 14:30:56 - src.data_preprocessing.data_preprocessor - INFO - 数据清洗完成
2025-08-25 14:30:56 - src.data_preprocessing.data_preprocessor - INFO - 处理目标变量...
2025-08-25 14:30:56 - src.data_preprocessing.data_preprocessor - INFO - 目标变量无需填充，均值: 0.0143
2025-08-25 14:30:56 - src.data_preprocessing.data_preprocessor - INFO - 计算目标变量异常值阈值...
2025-08-25 14:30:56 - src.data_preprocessing.data_preprocessor - INFO - 目标变量异常值范围: [-5.4179, 5.4465]
2025-08-25 14:30:56 - src.data_preprocessing.data_preprocessor - INFO - 目标变量异常值处理: 裁剪 5% 上下限
2025-08-25 14:30:56 - src.data_preprocessing.data_preprocessor - INFO - 拟合特征缩放器...
2025-08-25 14:30:58 - src.data_preprocessing.data_preprocessor - INFO - 拟合目标变量缩放器...
2025-08-25 14:30:58 - src.data_preprocessing.data_preprocessor - INFO - 执行特征重要性评估...
2025-08-25 14:30:59 - src.data_preprocessing.data_preprocessor - INFO - 特征重要性评估样本大小: 4884
2025-08-25 14:30:59 - src.model.lstm_lgbm_predictor - INFO - 设置特征列: 6个特征
2025-08-25 14:31:00 - src.model.lstm_lgbm_predictor - ERROR - 模型训练失败: module 'keras._tf_keras.keras.losses' has no attribute 'mean_squared_error'
2025-08-25 14:31:00 - __main__ - ERROR - 系统执行失败: module 'keras._tf_keras.keras.losses' has no attribute 'mean_squared_error'
Traceback (most recent call last):
  File "d:\Projects\stock_selection\main.py", line 107, in main
    X_sequence_scaled, y_scaled, stock_codes, dates = preprocessor.fit(
  File "d:\Projects\stock_selection\src\data_preprocessing\data_preprocessor.py", line 368, in fit
    model.fit(X_sequence=X_subset_scaled,
  File "d:\Projects\stock_selection\src\model\lstm_lgbm_predictor.py", line 161, in fit
    lstm_history = self.lstm_model.fit(
  File "D:\Projects\stock_selection\.venv\lib\site-packages\keras\src\utils\traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "d:\Projects\stock_selection\src\model\lstm_lgbm_predictor.py", line 120, in _direction_weighted_loss
    mse_loss = tf.keras.losses.mean_squared_error(y_true, y_pred)
AttributeError: module 'keras._tf_keras.keras.losses' has no attribute 'mean_squared_error'
2025-08-25 14:33:57 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:33:57 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:33:57 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:33:57 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:33:59 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:33:59 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:33:59 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:33:59 - src.data_preprocessing.data_preprocessor - INFO - DataFrame columns: ['trade_date', 'ts_code', 'open', 'close', 'high', 'low', 'volume', 'amount', 'amplitude', 'change', 'change_amount', 'turnover']
2025-08-25 14:33:59 - __main__ - INFO - 数据质量报告:
缺失值统计: {'trade_date': 0, 'ts_code': 0, 'open': 0, 'close': 0, 'high': 0, 'low': 0, 'volume': 0, 'amount': 0, 'amplitude': 0, 'change': 0, 'change_amount': 796, 'turnover': 0}
重复记录数: 0
股票覆盖数: 800
交易日期范围: ('20220104', '20250819')
价格异常数: 0
成交量异常数: 0
2025-08-25 14:33:59 - __main__ - INFO - ====== 开始计算技术指标 ======
2025-08-25 14:34:17 - __main__ - INFO - 技术指标计算完成，无NaN值
2025-08-25 14:34:17 - __main__ - INFO - ====== 初始化LSTM+LightGBM模型 ======
2025-08-25 14:34:17 - __main__ - INFO - 模型初始化成功
2025-08-25 14:34:17 - __main__ - INFO - ====== 数据预处理和SHAP特征选择 ======
2025-08-25 14:34:17 - src.data_preprocessing.data_preprocessor - INFO - 开始数据预处理和拟合...
2025-08-25 14:34:17 - src.data_preprocessing.data_preprocessor - INFO - 输入数据形状: (691696, 33)
2025-08-25 14:34:17 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成...
2025-08-25 14:34:17 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成，股票数量: 800
2025-08-25 14:34:17 - src.data_preprocessing.data_preprocessor - INFO - 创建技术信号...
2025-08-25 14:34:17 - src.data_preprocessing.data_preprocessor - INFO - 技术信号创建完成，新增特征数量: 1
2025-08-25 14:34:17 - src.data_preprocessing.data_preprocessor - INFO - 开始创建目标变量，预测周期: 5
2025-08-25 14:34:17 - src.data_preprocessing.data_preprocessor - INFO - 目标变量创建完成，有效样本数: 691691, 均值: 0.0136, 标准差: 1.0706
2025-08-25 14:34:17 - src.data_preprocessing.data_preprocessor - INFO - 开始特征选择...
2025-08-25 14:34:17 - src.data_preprocessing.data_preprocessor - INFO - 原始特征数量: 31
2025-08-25 14:34:17 - src.data_preprocessing.data_preprocessor - INFO - 缺失值过滤后特征数量: 31
2025-08-25 14:34:17 - src.data_preprocessing.data_preprocessor - INFO - 开始多重共线性检测，输入特征数量: 31, VIF阈值: 5.0
2025-08-25 14:34:18 - src.data_preprocessing.data_preprocessor - INFO - 预过滤高相关特征: 70 个 (相关系数>0.8)
2025-08-25 14:35:20 - src.data_preprocessing.data_preprocessor - INFO - 多重共线性检测完成: 最终选择 6 个特征
2025-08-25 14:35:20 - src.data_preprocessing.data_preprocessor - INFO - 选择的特征: ['change', 'turnover', 'CCI', 'OBV', 'CMF', 'CDL_DOJI']
2025-08-25 14:35:20 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据...
2025-08-25 14:35:20 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据，特征数量: 6
2025-08-25 14:35:20 - src.data_preprocessing.data_preprocessor - INFO - Processing stocks: 
2025-08-25 14:35:27 - src.data_preprocessing.data_preprocessor - INFO - 序列诊断: 总股票 800, 跳过数据不足 1, 跳过NaN序列 0, 有效序列 671641
2025-08-25 14:35:27 - src.data_preprocessing.data_preprocessor - INFO - 生成序列完成: 671641个样本，维度: (671641, 20, 6)
2025-08-25 14:35:27 - src.data_preprocessing.data_preprocessor - INFO - 计算特征异常值边界...
2025-08-25 14:35:27 - src.data_preprocessing.data_preprocessor - INFO - 特征异常值边界计算完成: 6 个特征
2025-08-25 14:35:27 - src.data_preprocessing.data_preprocessor - INFO - 开始清洗数据...
2025-08-25 14:35:28 - src.data_preprocessing.data_preprocessor - INFO - 特征 change: 裁剪范围 [0.01, 0.01]
2025-08-25 14:35:29 - src.data_preprocessing.data_preprocessor - INFO - 特征 turnover: 裁剪范围 [0.01, 0.01]
2025-08-25 14:35:29 - src.data_preprocessing.data_preprocessor - INFO - 特征 CCI: 裁剪范围 [0.01, 0.01]
2025-08-25 14:35:30 - src.data_preprocessing.data_preprocessor - INFO - 特征 OBV: 裁剪范围 [0.01, 0.01]
2025-08-25 14:35:31 - src.data_preprocessing.data_preprocessor - INFO - 特征 CMF: 裁剪范围 [0.01, 0.01]
2025-08-25 14:35:31 - src.data_preprocessing.data_preprocessor - INFO - 特征 CDL_DOJI: 裁剪范围 [0.01, 0.01]
2025-08-25 14:35:31 - src.data_preprocessing.data_preprocessor - INFO - 数据清洗完成
2025-08-25 14:35:31 - src.data_preprocessing.data_preprocessor - INFO - 处理目标变量...
2025-08-25 14:35:31 - src.data_preprocessing.data_preprocessor - INFO - 目标变量无需填充，均值: 0.0143
2025-08-25 14:35:31 - src.data_preprocessing.data_preprocessor - INFO - 计算目标变量异常值阈值...
2025-08-25 14:35:32 - src.data_preprocessing.data_preprocessor - INFO - 目标变量异常值范围: [-5.4179, 5.4465]
2025-08-25 14:35:32 - src.data_preprocessing.data_preprocessor - INFO - 目标变量异常值处理: 裁剪 5% 上下限
2025-08-25 14:35:32 - src.data_preprocessing.data_preprocessor - INFO - 拟合特征缩放器...
2025-08-25 14:35:34 - src.data_preprocessing.data_preprocessor - INFO - 拟合目标变量缩放器...
2025-08-25 14:35:34 - src.data_preprocessing.data_preprocessor - INFO - 执行特征重要性评估...
2025-08-25 14:35:35 - src.data_preprocessing.data_preprocessor - INFO - 特征重要性评估样本大小: 3748
2025-08-25 14:35:35 - src.model.lstm_lgbm_predictor - INFO - 设置特征列: 6个特征
2025-08-25 14:35:37 - src.model.lstm_lgbm_predictor - ERROR - 模型训练失败: Input 'y' of 'Equal' Op has type float16 that does not match type float32 of argument 'x'.
2025-08-25 14:35:37 - __main__ - ERROR - 系统执行失败: Input 'y' of 'Equal' Op has type float16 that does not match type float32 of argument 'x'.
Traceback (most recent call last):
  File "d:\Projects\stock_selection\main.py", line 107, in main
    X_sequence_scaled, y_scaled, stock_codes, dates = preprocessor.fit(
  File "d:\Projects\stock_selection\src\data_preprocessing\data_preprocessor.py", line 368, in fit
    model.fit(X_sequence=X_subset_scaled,
  File "d:\Projects\stock_selection\src\model\lstm_lgbm_predictor.py", line 161, in fit
    lstm_history = self.lstm_model.fit(
  File "D:\Projects\stock_selection\.venv\lib\site-packages\keras\src\utils\traceback_utils.py", line 122, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "d:\Projects\stock_selection\src\model\lstm_lgbm_predictor.py", line 136, in _direction_accuracy
    tf.cast(tf.sign(y_true) == tf.sign(y_pred), tf.float32)
TypeError: Input 'y' of 'Equal' Op has type float16 that does not match type float32 of argument 'x'.
2025-08-25 14:38:45 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:38:45 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:38:45 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:38:45 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:38:47 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:38:47 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:38:47 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:38:47 - src.data_preprocessing.data_preprocessor - INFO - DataFrame columns: ['trade_date', 'ts_code', 'open', 'close', 'high', 'low', 'volume', 'amount', 'amplitude', 'change', 'change_amount', 'turnover']
2025-08-25 14:38:48 - __main__ - INFO - 数据质量报告:
缺失值统计: {'trade_date': 0, 'ts_code': 0, 'open': 0, 'close': 0, 'high': 0, 'low': 0, 'volume': 0, 'amount': 0, 'amplitude': 0, 'change': 0, 'change_amount': 796, 'turnover': 0}
重复记录数: 0
股票覆盖数: 800
交易日期范围: ('20220104', '20250819')
价格异常数: 0
成交量异常数: 0
2025-08-25 14:38:48 - __main__ - INFO - ====== 开始计算技术指标 ======
2025-08-25 14:39:04 - __main__ - INFO - 技术指标计算完成，无NaN值
2025-08-25 14:39:04 - __main__ - INFO - ====== 初始化LSTM+LightGBM模型 ======
2025-08-25 14:39:04 - __main__ - INFO - 模型初始化成功
2025-08-25 14:39:04 - __main__ - INFO - ====== 数据预处理和SHAP特征选择 ======
2025-08-25 14:39:04 - src.data_preprocessing.data_preprocessor - INFO - 开始数据预处理和拟合...
2025-08-25 14:39:04 - src.data_preprocessing.data_preprocessor - INFO - 输入数据形状: (691696, 33)
2025-08-25 14:39:04 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成...
2025-08-25 14:39:04 - src.data_preprocessing.data_preprocessor - INFO - 数据排序完成，股票数量: 800
2025-08-25 14:39:04 - src.data_preprocessing.data_preprocessor - INFO - 创建技术信号...
2025-08-25 14:39:04 - src.data_preprocessing.data_preprocessor - INFO - 技术信号创建完成，新增特征数量: 1
2025-08-25 14:39:04 - src.data_preprocessing.data_preprocessor - INFO - 开始创建目标变量，预测周期: 5
2025-08-25 14:39:04 - src.data_preprocessing.data_preprocessor - INFO - 目标变量创建完成，有效样本数: 691691, 均值: 0.0136, 标准差: 1.0706
2025-08-25 14:39:04 - src.data_preprocessing.data_preprocessor - INFO - 开始特征选择...
2025-08-25 14:39:04 - src.data_preprocessing.data_preprocessor - INFO - 原始特征数量: 31
2025-08-25 14:39:04 - src.data_preprocessing.data_preprocessor - INFO - 缺失值过滤后特征数量: 31
2025-08-25 14:39:04 - src.data_preprocessing.data_preprocessor - INFO - 开始多重共线性检测，输入特征数量: 31, VIF阈值: 5.0
2025-08-25 14:39:06 - src.data_preprocessing.data_preprocessor - INFO - 预过滤高相关特征: 70 个 (相关系数>0.8)
2025-08-25 14:40:04 - src.data_preprocessing.data_preprocessor - INFO - 多重共线性检测完成: 最终选择 6 个特征
2025-08-25 14:40:04 - src.data_preprocessing.data_preprocessor - INFO - 选择的特征: ['change', 'turnover', 'CCI', 'OBV', 'CMF', 'CDL_DOJI']
2025-08-25 14:40:04 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据...
2025-08-25 14:40:04 - src.data_preprocessing.data_preprocessor - INFO - 创建时序数据，特征数量: 6
2025-08-25 14:40:04 - src.data_preprocessing.data_preprocessor - INFO - Processing stocks: 
2025-08-25 14:40:10 - src.data_preprocessing.data_preprocessor - INFO - 序列诊断: 总股票 800, 跳过数据不足 1, 跳过NaN序列 0, 有效序列 671641
2025-08-25 14:40:10 - src.data_preprocessing.data_preprocessor - INFO - 生成序列完成: 671641个样本，维度: (671641, 20, 6)
2025-08-25 14:40:10 - src.data_preprocessing.data_preprocessor - INFO - 计算特征异常值边界...
2025-08-25 14:40:11 - src.data_preprocessing.data_preprocessor - INFO - 特征异常值边界计算完成: 6 个特征
2025-08-25 14:40:11 - src.data_preprocessing.data_preprocessor - INFO - 开始清洗数据...
2025-08-25 14:40:11 - src.data_preprocessing.data_preprocessor - INFO - 特征 change: 裁剪范围 [0.01, 0.01]
2025-08-25 14:40:12 - src.data_preprocessing.data_preprocessor - INFO - 特征 turnover: 裁剪范围 [0.01, 0.01]
2025-08-25 14:40:13 - src.data_preprocessing.data_preprocessor - INFO - 特征 CCI: 裁剪范围 [0.01, 0.01]
2025-08-25 14:40:14 - src.data_preprocessing.data_preprocessor - INFO - 特征 OBV: 裁剪范围 [0.01, 0.01]
2025-08-25 14:40:15 - src.data_preprocessing.data_preprocessor - INFO - 特征 CMF: 裁剪范围 [0.01, 0.01]
2025-08-25 14:40:15 - src.data_preprocessing.data_preprocessor - INFO - 特征 CDL_DOJI: 裁剪范围 [0.01, 0.01]
2025-08-25 14:40:15 - src.data_preprocessing.data_preprocessor - INFO - 数据清洗完成
2025-08-25 14:40:15 - src.data_preprocessing.data_preprocessor - INFO - 处理目标变量...
2025-08-25 14:40:15 - src.data_preprocessing.data_preprocessor - INFO - 目标变量无需填充，均值: 0.0143
2025-08-25 14:40:15 - src.data_preprocessing.data_preprocessor - INFO - 计算目标变量异常值阈值...
2025-08-25 14:40:15 - src.data_preprocessing.data_preprocessor - INFO - 目标变量异常值范围: [-5.4179, 5.4465]
2025-08-25 14:40:15 - src.data_preprocessing.data_preprocessor - INFO - 目标变量异常值处理: 裁剪 5% 上下限
2025-08-25 14:40:15 - src.data_preprocessing.data_preprocessor - INFO - 拟合特征缩放器...
2025-08-25 14:40:18 - src.data_preprocessing.data_preprocessor - INFO - 拟合目标变量缩放器...
2025-08-25 14:40:18 - src.data_preprocessing.data_preprocessor - INFO - 执行特征重要性评估...
2025-08-25 14:40:19 - src.data_preprocessing.data_preprocessor - INFO - 特征重要性评估样本大小: 4028
2025-08-25 14:40:20 - src.model.lstm_lgbm_predictor - INFO - 设置特征列: 6个特征
2025-08-25 14:42:08 - src.model.lstm_lgbm_predictor - ERROR - 模型训练失败: fit() got an unexpected keyword argument 'verbose'
2025-08-25 14:42:08 - __main__ - ERROR - 系统执行失败: fit() got an unexpected keyword argument 'verbose'
Traceback (most recent call last):
  File "d:\Projects\stock_selection\main.py", line 107, in main
    X_sequence_scaled, y_scaled, stock_codes, dates = preprocessor.fit(
  File "d:\Projects\stock_selection\src\data_preprocessing\data_preprocessor.py", line 368, in fit
    model.fit(X_sequence=X_subset_scaled,
  File "d:\Projects\stock_selection\src\model\lstm_lgbm_predictor.py", line 175, in fit
    self.lgbm_model.fit(
TypeError: fit() got an unexpected keyword argument 'verbose'
2025-08-25 14:43:49 - __main__ - INFO - ====== 开始数据获取 ======
2025-08-25 14:43:49 - __main__ - INFO - 正常模式：使用20150827 到 20250824年数据
2025-08-25 14:43:49 - src.data_storage.data_saver - INFO - init saver, file path: ./data\stock_data.db
2025-08-25 14:43:49 - src.data_storage.data_saver - INFO - read stock_daily data from sqlite, sql command: select * from stock_daily where trade_date >= 20150827 and trade_date <= 20250824
2025-08-25 14:43:51 - __main__ - INFO - 获取数据完成: 20220104至20250819, 共691696条记录, 800支股票
2025-08-25 14:43:52 - __main__ - INFO - 过滤后剩余股票: 800
2025-08-25 14:43:52 - __main__ - INFO - ====== 开始数据质量检查 ======
2025-08-25 14:43:52 - src.data_preprocessing.data_preprocessor - INFO - DataFrame columns: ['trade_date', 'ts_code', 'open', 'close', 'high', 'low', 'volume', 'amount', 'amplitude', 'change', 'change_amount', 'turnover']
2025-08-25 14:43:52 - __main__ - INFO - 数据质量报告:
缺失值统计: {'trade_date': 0, 'ts_code': 0, 'open': 0, 'close': 0, 'high': 0, 'low': 0, 'volume': 0, 'amount': 0, 'amplitude': 0, 'change': 0, 'change_amount': 796, 'turnover': 0}
重复记录数: 0
股票覆盖数: 800
交易日期范围: ('20220104', '20250819')
价格异常数: 0
成交量异常数: 0
2025-08-25 14:43:52 - __main__ - INFO - ====== 开始计算技术指标 ======
